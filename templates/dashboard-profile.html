{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}User Profile{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard-profile.css' %}">
{% endblock %}

{% block content %}
<div class="header">
    <button class="hamburger" id="hamburger">
        <i class="fas fa-bars"></i>
    </button>
    <h1 class="page-title">My Profile</h1>
    <div class="action-buttons">
        <button type="button" class="btn" id="toggleEditBtn"><i class="fas fa-edit"></i> Edit Profile</button>
    </div>
</div>

<!-- Main Content Area -->
<div class="profile-layout">
    <!-- Profile Card -->
    <div class="profile-card">
        <div class="cover-photo"></div>
        <div class="profile-info">
            <div class="large-profile-pic">
                <img src="{{ user.profile_img.url|default:'/media/default_pf.png' }}" alt="Profile"
                    class="avatar-large">
            </div>
            <h2>{{ user.first_name }} {{ user.last_name }}</h2>

            {% if user.is_verified %}
            <div class="verification-badge verified">
                Verification: Verified <i class="fas fa-check-circle"></i>
            </div>
            {% else %}
            <div class="verification-badge pending">
                Verification: Pending <i class="fas fa-clock"></i>
            </div>
            {% endif %}

            <div class="profile-info-list">
                <div class="info-row">
                    <span class="info-label">Class Year:</span>
                    <span class="info-value-display">{{ user.batchno|default:"Not provided" }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Major:</span>
                    <span class="info-value-display">{{ user.subject|default:"Not provided" }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Location:</span>
                    <span class="info-value-display">{{ user.location|default:"Not provided" }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Company:</span>
                    <span class="info-value-display">{{ user.c_name|default:"Not provided" }}</span>
                </div>
            </div>
        </div>

        {% if not user.is_verified %}
        <div class="verification-request-section"
            style="margin-top: 20px; text-align: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
            {% if on_cooldown %}
            <p style="color: #fbbf24; font-weight: 500; margin-bottom: 5px;"><i class="fas fa-clock"></i> Verification
                Request Sent</p>
            <p style="color: var(--text-light); font-size: 0.9rem;">You can send another request in {{ remaining_days }}
                days.</p>
            {% else %}
            <p style="color: var(--text-light); margin-bottom: 15px; font-size: 0.9rem;">Want to get verified badge?</p>
            <form method="post" action="{% url 'dashboard-profile' %}">
                {% csrf_token %}
                <button type="submit" name="request_verification" class="btn"
                    style="background: linear-gradient(135deg, var(--primary), var(--events-color)); color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 0.9rem;">
                    Request Verification <i class="fas fa-paper-plane" style="margin-left: 5px;"></i>
                </button>
            </form>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Personal Details Section -->
    <div class="profile-form-section">
        <div class="section-header">
            <h2 class="section-title">Personal Details</h2>
        </div>

        <form id="profileForm" method="post" enctype="multipart/form-data" action="{% url 'dashboard-profile' %}">
            {% csrf_token %}
            <div class="profile-details">
                <!-- Profile Image Upload (Hidden by default or part of edit flow) -->
                <div class="form-group full-width image-upload-group" style="display:none;">
                    <label>Profile Image</label>
                    <input type="file" name="profile_img" class="edit-input">
                </div>

                <div class="form-group">
                    <label>Full Name</label>
                    <div class="value">{{ user.first_name }} {{ user.last_name }}</div>
                    <input type="text" name="full_name" class="edit-input"
                        value="{{ user.first_name }} {{ user.last_name }}" style="display:none;">
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <div class="value">{{ user.email }}</div>
                    <input type="email" name="email" class="edit-input" value="{{ user.email }}" style="display:none;">
                </div>

                <div class="form-group">
                    <label>Phone</label>
                    <div class="value">{{ user.Phone_no }}</div>
                    <input type="text" name="phone_no" class="edit-input" value="{{ user.Phone_no|default:'' }}"
                        style="display:none;">
                </div>

                <div class="form-group">
                    <label>University</label>
                    <div class="value">{{ user.university }}</div>
                    <input type="text" name="university" class="edit-input" value="{{ user.university }}"
                        style="display:none;">
                </div>

                <div class="form-group">
                    <label>Major (Subject)</label>
                    <div class="value">{{ user.subject }}</div>
                    <input type="text" name="subject" class="edit-input" value="{{ user.subject }}"
                        style="display:none;">
                </div>

                <div class="form-group">
                    <label>Passing Year</label>
                    <div class="value">{{ user.passing_year }}</div>
                    <input type="text" name="passing_year" class="edit-input" value="{{ user.passing_year }}"
                        style="display:none;">
                </div>

                <div class="form-group">
                    <label>Current Company</label>
                    <div class="value">{{ user.c_name }}</div>
                    <input type="text" name="c_name" class="edit-input" value="{{ user.c_name }}" style="display:none;">
                </div>

                <div class="form-group">
                    <label>Position</label>
                    <div class="value">{{ user.current_position }}</div>
                    <input type="text" name="current_position" class="edit-input" value="{{ user.current_position }}"
                        style="display:none;">
                </div>

                <div class="form-group full-width">
                    <label>About Me</label>
                    <div class="value">{{ user.bio }}</div>
                    <textarea name="bio" id="input_bio" class="edit-input"
                        style="display:none;">{{ user.bio }}</textarea>
                </div>

                <div class="form-group">
                    <label>Location</label>
                    <div class="value">{{ user.location }}</div>
                    <input type="text" name="location" id="input_location" class="edit-input"
                        value="{{ user.location }}" style="display:none;">
                </div>

                <!-- Social Media Section -->
                <div class="form-group full-width">
                    <h3 class="section-title"
                        style="margin-top: 20px; font-size: 1.1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
                        Social Media Links</h3>
                </div>

                <div class="form-group">
                    <label>LinkedIn URL</label>
                    <div class="value">{{ user.social_links.linkedin|default:"Not set" }}</div>
                    <input type="url" name="linkedin" class="edit-input"
                        value="{{ user.social_links.linkedin|default:'' }}" style="display:none;"
                        placeholder="https://linkedin.com/in/...">
                </div>

                <div class="form-group">
                    <label>GitHub URL</label>
                    <div class="value">{{ user.social_links.github|default:"Not set" }}</div>
                    <input type="url" name="github" class="edit-input" value="{{ user.social_links.github|default:'' }}"
                        style="display:none;" placeholder="https://github.com/...">
                </div>

                <div class="form-group">
                    <label>Twitter/X URL</label>
                    <div class="value">{{ user.social_links.twitter|default:"Not set" }}</div>
                    <input type="url" name="twitter" class="edit-input"
                        value="{{ user.social_links.twitter|default:'' }}" style="display:none;"
                        placeholder="https://twitter.com/...">
                </div>

                <div class="form-group">
                    <label>Portfolio / Other</label>
                    <div class="value">{{ user.social_links.other|default:"Not set" }}</div>
                    <input type="url" name="other" class="edit-input" value="{{ user.social_links.other|default:'' }}"
                        style="display:none;" placeholder="https://...">
                </div>

                <div class="form-group full-width" id="saveContainer" style="display:none;">
                    <button type="submit" class="btn btn-save" id="submitBtn">Save Changes</button>
                    <button type="button" class="btn btn-cancel" id="cancelEditBtn">Cancel</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Edit Profile Modal (Alternative if implemented via modal as suggested by css, but checking html structure showed form toggle) -->
<!-- Keeping existing structure: Form toggle seems to be the logic based on JS -->

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/dashboard-profile.js' %}?v={% now 'U' %}"></script>
{% endblock %}